@model Repository.ViewModel.UserViewModel;

@{
    ViewData["Title"] = "Profile";
}


<div class="add_user_heading d-flex justify-content-between">
    <div class="fw-bold fs-2">My Profile</div>
</div>

<div class="add_user_form mb-2 pb-1">

    <img width="100" height="100" class="me-4 profile_bg" src="~/images/profile_div_bg.jpg" style=" opacity: 2" alt="">
    <div class="avatar d-flex" style="height: 44px;">
        <a>
            <img src="@(string.IsNullOrEmpty(Model.Profileimagepath) ? @Context.Request.Cookies["Image"] : "/images/Default_pfp.svg.png")"
                style="position: relative; top:-30px; height: 90px; left: 18px; object-fit: cover;" alt="Image"
                id="ProfileImagePreview" class=" rounded-circle border" />
        </a>

        <a><img style="position: absolute; width: 25px; height: 25px;" class="my-4" src="/images/Download/camera.svg"
                onclick="OpenFile()"></a>

        <input type="file" style="display: none;" id="FileInput">
        <div class="ps-4 ms-2 mt-1">
            <h3 class="m-0">@Model.Firstname</h3>
            <p>@Model.Rolename</p>
        </div>
        <div class="ms-auto me-2 mt-3">
            <div>@Model.Email</div>
        </div>
    </div>
    <form method="post">
        <div class="row mx-0 mt-3">
            <div class="col-lg-6 col-md-6 mt-3">
                <div class="form-floating">
                    <input type="text" class="form-control add_user_input" id="floatingInput"
                        placeholder="name@example.com" asp-for="Firstname" value="@Model.Firstname">
                    <label for="floatingInput">First Name</label>
                </div>
            </div>
            <div class="col-lg-6 col-md-6 mt-3">
                <div class="form-floating">
                    <input type="text" class="form-control add_user_input" id="exampleInput"
                        aria-describedby="emailHelp" placeholder="Last Name" asp-for="Lastname" value="@Model.Lastname">
                    <label for="floatingInput">Last Name</label>
                </div>
            </div>
        </div>

        <div class="row mx-0">
            <div class="col-lg-6 col-md-6 mt-3">
                <div class="form-floating">
                    <input type="text" class="form-control add_user_input" id="floatingInput"
                        placeholder="name@example.com" asp-for="Username" value="@Model.Username">
                    <label for="floatingInput">User Name</label>
                </div>
            </div>
            <div class="col-lg-6 col-md-6 mt-3">
                <div class="form-floating">
                    <input type="text" class="form-control add_user_input" id="floatingInput"
                        placeholder="name@example.com" asp-for="Phone" value="@Model.Phone">
                    <label for="floatingInput">Phone</label>
                </div>
            </div>
        </div>

        <div class="row mx-0">
            <div class="col-lg-4 col-md-4 col-sm-12 mt-3">
                <select class="form-select dropdown" asp-for="Country" id="Country">
                    <option>Select Country</option>
                </select>
            </div>

            <div class="col-lg-4 col-md-4 col-sm-12 mt-3">
                <select class="form-select" asp-for="State" id="State">
                    <option>Select State</option>
                </select>
            </div>

            <div class="col-lg-4 col-md-4 col-sm-12 mt-3">
                <select class="form-select" asp-for="City" id="City">
                    <option>Select City</option>
                </select>
            </div>
        </div>

        <div class="row mx-0">
            <div class="col-lg-8 col-md-4 col-sm-12 mt-3">
                <div class="form-floating">
                    <input type="text" class="form-control add_user_input" id="floatingInput"
                        placeholder="name@example.com" asp-for="Address" value="@Model.Address">
                    <label for="floatingInput">Address</label>
                </div>
            </div>
            <div class="col-lg-4 col-md-4 col-sm-12 mt-3">
                <div class="form-floating">
                    <input type="text" class="form-control add_user_input" id="floatingInput"
                        placeholder="name@example.com" asp-for="Zipcode" value="@Model.Zipcode">
                    <label for="floatingInput">Zipcode</label>
                </div>
            </div>
        </div>

        <div class="create_cancel_btn my-3 d-flex justify-content-end">
            <button type="submit" class="btn btn-primary me-2">Update</button>
            <a asp-controller="Dashboard" asp-action="Index" class="btn border-primary">Cancel</a>
        </div>
    </form>
</div>

<script>

    $(document).ready(function () {

        // Fetch and populate countries on page load
        $.getJSON('/GetData/GetCountries', function (data) {
            $("#Country").html('<option selected>@(Model.Country)</option>');
            $("#State").html('<option selected>@(Model.State)</option>');
            $("#City").html('<option selected>@(Model.City)</option>');
            $("#Country").append('<option value="">Select Country</option>');
            $.each(data, function (index, country) {
                $("#Country").append(`<option value="${country.countryId}">${country.countryName}</option>`);
            });
        });

        // Fetch states when a country is selected
        $("#Country").change(function () {
            var countryId = $(this).val();
            $("#State").html('<option value="">Select State</option>').prop("disabled", true);
            $("#City").html('<option value="">Select City</option>').prop("disabled", true);

            if (countryId) {
                $.getJSON(`/GetData/GetStates?countryId=${countryId}`, function (data) {
                    $("#State").prop("disabled", false);
                    $.each(data, function (index, state) {
                        $("#State").append(`<option value="${state.stateId}">${state.stateName}</option>`);
                    });
                });
            }
        });

        // Fetch cities when a state is selected
        $("#State").change(function () {
            var stateId = $(this).val();
            $("#City").html('<option value="">Select City</option>').prop("disabled", true);

            if (stateId) {
                $.getJSON(`/GetData/GetCities?stateId=${stateId}`, function (data) {
                    $("#City").prop("disabled", false);
                    $.each(data, function (index, city) {
                        $("#City").append(`<option value="${city.cityId}">${city.cityName}</option>`);
                    });
                });
            }
        });
    });

    function OpenFile() {
        document.getElementById("FileInput").click();
    }

    document.getElementById("FileInput").addEventListener("change", function (event) {
        var file = event.target.files[0];
        if (file) {
            var reader = new FileReader();
            reader.onload = function (e) {
                document.getElementById("ProfileImagePreview").src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
    });
</script>